extends layout

block content
  .container
    .btn-group(role='toolbar' aria-label='...')
      .btn-group(role='group')
        button.btn.btn-default.dropdown-toggle#langSelect(type='button' data-toggle='dropdown' aria-haspopup='true'
          aria-expanded='false') Language 
          span.caret
        ul.dropdown-menu#lang(aria-labelledby='langSelect')
          li 
            a(value='python3') Python 3
          li
            a(value='gcc') C
          li 
            a(value='g++') C++

      .btn-group(role='group')
        button.btn.btn-default.dropdown-toggle#editorSelect(type='button' data-toggle='dropdown' aria-haspopup='true'
          aria-expanded='false') Editor Mode 
          span.caret
        ul.dropdown-menu#editor(aria-labelledby='editorSelect')
          li 
            a(value='vim') vim
          li
            a(value='emacs') emacs
          li 
            a(value='sublime') sublime 
          li
            a(value='default') default

      .btn-group(role='group')
        button.btn.btn-default.dropdown-toggle#themeSelect(type='button' data-toggle='dropdown' aria-haspopup='true'
          aria-expanded='false') Theme 
          span.caret
        ul.dropdown-menu#theme(aria-labelledby='themeSelect')
          li 
            a(value='solarized dark') solarized dark 
          li
            a(value='solarized light') solarized light
          li 
            a(value='blackboard') blackboard 
          li 
            a(value='dracula') dracula 
          li 
            a(value='monokai') monokai 
          li 
            a(value='zenburn') zenburn 
          li 
            a(value='tomorrow-night-bright') tomorrow-night-bright 
          li 
            a(value='tomorrow-night-eighties') tomorrow-night-eighties 
          li
            a(value='default') default

  .container
    form
      .form-group
        textarea.form-control#code(rows='30' name='code')

  .container
    button.btn.btn-default#compile Fire in the hole!

  .container
    .row
      .col-md-6
        h4 Input
        form
          textarea.form-control#input(rows='5' name='input')
      .col-md-6
        h4 Output
        form
          textarea.form-control#output(rows='5' name='output')

  script.
    $(function() {
      var editor = CodeMirror.fromTextArea(document.getElementById("code"));
      var compiler = "python3"
      editor.setOption("lineNumbers", true);

      $('button#compile').click(function() {
        $.ajax({
          type: "POST",
          url: "/ide",
          data: "code=" + encodeURIComponent(editor.getValue()) + "&input=" 
                  + encodeURIComponent($('#input').val()) + "&compiler="
                  + encodeURIComponent(compiler), 
          success: function(data) {
            console.log(data);
            $('#output').val(data);
          }
        });
      });

      $('.dropdown-menu#editor li a').click(function() {
        selection = $(this).text();
        $('#editorSelect').text(selection + ' ');
        var value = $(this).attr('value');
        editor.setOption("keyMap", value);
       $("<span class='caret'></span>").appendTo("#editorSelect");
      });

      $('.dropdown-menu#lang li a').click(function() {
        selection = $(this).text();
        $('#langSelect').text(selection + ' ');
        var value = $(this).attr('value');
        compiler = value;
        $("<span class='caret'></span>").appendTo("#langSelect");
      });

      $('.dropdown-menu#theme li a').click(function() {
        selection = $(this).text();
        $('#themeSelect').text(selection + ' ');
        var value = $(this).attr('value');
        editor.setOption("theme", value);
        $("<span class='caret'></span>").appendTo("#themeSelect");
      });

    });
